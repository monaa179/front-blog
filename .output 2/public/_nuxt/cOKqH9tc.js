import{x as O,y as H,B as ne,o,c as a,a as e,r as b,F as $,A as x,d as R,t as k,l as w,b as I,T as oe,w as W,C as A,s as h,D as j,_ as N,p as r,E as le,k as ae,m as ie,G as re,q as de,z as q}from"./C_A17Xze.js";import{u as ce}from"./pLjy45M9.js";import{L as ue}from"./CG3JdVlk.js";import{f as ve}from"./CXg0sqL6.js";import{C as me}from"./Ckzw1s2j.js";import"./pMK9VmZY.js";import"./Cl4ISXQJ.js";const pe={key:0,class:"placeholder"},he=["onClick"],fe={key:0,class:"dropdown-menu"},ge={class:"dropdown-content"},be=["onClick"],ke={class:"check-box"},we={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round",width:"10",height:"10"},ye={class:"item-label"},_e={key:0,class:"empty-dropdown"},Ce=O({__name:"ModuleSelector",props:{modelValue:{},availableModules:{}},emits:["update:modelValue"],setup(u,{emit:D}){const f=u,p=D,d=h(!1),l=h(null),c=j(()=>f.modelValue||[]),V=()=>{d.value=!d.value},S=g=>c.value.some(m=>m.id===g),T=g=>{const m=[...c.value],v=m.findIndex(M=>M.id===g.id);v>=0?m.splice(v,1):m.push(g),p("update:modelValue",m)},_=g=>{const m=c.value.filter(v=>v.id!==g);p("update:modelValue",m)},C=g=>{l.value&&!l.value.contains(g.target)&&(d.value=!1)};return H(()=>{document.addEventListener("click",C)}),ne(()=>{document.removeEventListener("click",C)}),(g,m)=>(o(),a("div",{class:"module-selector-wrapper",ref_key:"container",ref:l},[e("div",{class:"badges-list",onClick:V},[c.value.length===0?(o(),a("span",pe,"Select modules...")):b("",!0),(o(!0),a($,null,x(c.value,v=>(o(),a("span",{key:v.id,class:"module-badge"},[R(k(v.name)+" ",1),e("span",{class:"remove-x",onClick:w(M=>_(v.id),["stop"])},"×",8,he)]))),128))]),I(oe,{name:"dropdown"},{default:W(()=>[d.value?(o(),a("div",fe,[e("div",ge,[(o(!0),a($,null,x(u.availableModules,v=>(o(),a("div",{key:v.id,class:A(["dropdown-item",{active:S(v.id)}]),onClick:M=>T(v)},[e("span",ke,[S(v.id)?(o(),a("svg",we,[...m[0]||(m[0]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):b("",!0)]),e("span",ye,k(v.name),1)],10,be))),128)),u.availableModules.length===0?(o(),a("div",_e," No modules available ")):b("",!0)])])):b("",!0)]),_:1})],512))}}),$e=Object.assign(N(Ce,[["__scopeId","data-v-b0ff9ce5"]]),{__name:"ModuleSelector"}),De={class:"card-header"},Me={class:"article-title"},xe={class:"article-desc"},Se={class:"card-meta"},Ae={class:"card-date"},Ve=O({__name:"ArticleCard",props:{article:{},availableModules:{}},emits:["click","delete","update-modules"],setup(u){const D=u,f=h(!1),p=d=>{f.value=!0,d.dataTransfer&&(d.dataTransfer.effectAllowed="move",d.dataTransfer.setData("application/json",JSON.stringify(D.article)))};return(d,l)=>(o(),a("div",{class:A(["article-card",{published:u.article.status==="published",dragging:r(f)}]),draggable:"true",onDragstart:p,onDragend:l[4]||(l[4]=c=>f.value=!1),onClick:l[5]||(l[5]=c=>d.$emit("click",u.article))},[e("div",De,[e("h4",Me,k(u.article.original_title),1),e("button",{class:"minimal-delete",onClick:l[0]||(l[0]=w(c=>d.$emit("delete",u.article.id),["stop"])),title:"Supprimer"},[...l[6]||(l[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])])]),e("p",xe,k(u.article.original_description),1),e("div",Se,[e("div",{class:"modules-hint",onClick:l[2]||(l[2]=w(()=>{},["stop"]))},[I($e,{"model-value":u.article.modules,"available-modules":u.availableModules,"onUpdate:modelValue":l[1]||(l[1]=c=>d.$emit("update-modules",u.article.id,c))},null,8,["model-value","available-modules"])]),e("span",Ae,k(r(ve)(u.article.last_version_at||u.article.created_at)),1)]),d.$slots.actions?(o(),a("div",{key:0,class:"card-actions",onClick:l[3]||(l[3]=w(()=>{},["stop"]))},[le(d.$slots,"actions",{},void 0)])):b("",!0)],34))}}),Te=Object.assign(N(Ve,[["__scopeId","data-v-b6986797"]]),{__name:"ArticleCard"}),Le={class:"library-page"},Be={class:"page-header"},je={class:"header-content"},Oe={class:"header-actions"},Ie={class:"filter-wrapper"},Ne={class:"select-container"},ze=["value"],Ee={class:"board-container"},Pe={key:1,class:"kanban-board"},Ue=["onDragenter","onDrop"],qe={class:"column-header"},He={class:"column-title-group"},Re={class:"count-badge"},We={class:"column-content scroll-y"},Fe=["onClick","disabled"],Je={key:0,class:"loader-sm"},Ge=["onClick","disabled"],Ze={key:0,class:"loader-sm"},Ke=["onClick"],Qe=["onClick"],Xe={key:0,class:"empty-column"},Ye=O({__name:"library",setup(u){const D=ae(),f=h(null),p=h(null),d=h(!1),l=h(null),c=h(!1),V=h("Supprimer l'article"),S=h("Voulez-vous archiver cet article ou le supprimer définitivement ?"),T=h("Supprimer définitivement"),_=h(null),{articles:C,loading:g,allModules:m,fetch:v,fetchModules:M,archiveArticle:F,deleteArticle:J,updateStatus:z,updateModules:G}=ce({statuses:["validated","written","published","to_write"],order:{column:"created_at",ascending:!1}}),L=j(()=>f.value?C.value.filter(t=>t.modules.some(s=>s.id===f.value)):C.value),Z=j(()=>[{id:"validated",title:"Idées Validées",articles:L.value.filter(t=>t.status==="validated"||t.status==="to_write"),emptyMessage:"Aucune idée validée."},{id:"written",title:"Prêt",articles:L.value.filter(t=>t.status==="written"),emptyMessage:"Rien de prêt."},{id:"published",title:"Publié",articles:L.value.filter(t=>t.status==="published"),emptyMessage:"Aucun article publié."}]),E=t=>p.value===t.id?"Lancement...":t.versions_count&&t.versions_count>0?"Relancer":"Lancer la rédaction",P=t=>{t.last_version_content&&navigator.clipboard.writeText(t.last_version_content)},U=async t=>{p.value=t.id;try{const n=(await $fetch(`/api/articles/${t.id}/versions`,{method:"POST",body:{content:null}})).id;(await fetch("https://hook.eu2.make.com/fa1xbhnay548sl6gu5zt8amx9jecv77q",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article_id:t.id,version_id:n,modules:t.modules?.map(se=>se.name)})})).ok||await z(t.id,"validated")}catch(s){console.error(s)}finally{p.value=null}},K=t=>{_.value=t},Q=()=>{_.value=null},X=async(t,s)=>{_.value=null;const n=t.dataTransfer?.getData("application/json");if(n)try{const i=JSON.parse(n),y=s;if(i.status===y)return;await z(i.id,y)}catch(i){console.error("Drop error:",i)}},Y=t=>{const s=C.value.find(n=>n.id===t);s&&(l.value=s,d.value=!0)},B=()=>{d.value=!1,l.value=null,c.value=!1},ee=async()=>{if(!l.value)return;c.value=!0,await F(l.value.id)?B():c.value=!1},te=async()=>{if(!l.value)return;c.value=!0,await J(l.value.id)?B():c.value=!1};return H(()=>{M(),v()}),(t,s)=>(o(),a("div",Le,[e("header",Be,[e("div",je,[s[5]||(s[5]=e("div",{class:"header-text"},[e("h1",null,"Bibliothèque"),e("p",{class:"subtitle"},"Gerez la rédaction et la publication de vos contenus.")],-1)),e("div",Oe,[e("div",Ie,[s[4]||(s[4]=e("label",{class:"sr-only"},"Filtrer par module",-1)),e("div",Ne,[s[3]||(s[3]=e("svg",{class:"select-icon",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M22 3H2l8 9v6l4 2v-8L22 3z"})],-1)),ie(e("select",{"onUpdate:modelValue":s[0]||(s[0]=n=>de(f)?f.value=n:null),class:"minimal-select"},[s[2]||(s[2]=e("option",{value:null},"Tous les modules",-1)),(o(!0),a($,null,x(r(m),n=>(o(),a("option",{key:n.id,value:n.id},k(n.name),9,ze))),128))],512),[[re,r(f)]])])])])])]),e("div",Ee,[r(g)?(o(),q(ue,{key:0,message:"Chargement de vos articles..."})):(o(),a("div",Pe,[(o(!0),a($,null,x(r(Z),n=>(o(),a("div",{key:n.id,class:A(["kanban-column",[n.id,{"drag-over":r(_)===n.id}]]),onDragover:s[1]||(s[1]=w(()=>{},["prevent"])),onDragenter:i=>K(n.id),onDragleave:Q,onDrop:i=>X(i,n.id)},[e("div",qe,[e("div",He,[e("div",{class:A(["status-dot",n.id])},null,2),e("h3",null,k(n.title),1)]),e("span",Re,k(n.articles.length),1)]),e("div",We,[(o(!0),a($,null,x(n.articles,i=>(o(),q(Te,{key:i.id,article:i,"available-modules":r(m),onClick:y=>r(D).push(`/articles/${i.id}`),onDelete:Y,onUpdateModules:r(G)},{actions:W(()=>[n.id==="validated"?(o(),a("button",{key:0,class:"btn btn-primary btn-sm btn-full",onClick:w(y=>U(i),["stop"]),disabled:r(p)===i.id},[r(p)===i.id?(o(),a("div",Je)):b("",!0),e("span",null,k(E(i)),1)],8,Fe)):b("",!0),n.id==="written"?(o(),a($,{key:1},[e("button",{class:"btn btn-primary btn-sm btn-full",onClick:w(y=>U(i),["stop"]),disabled:r(p)===i.id},[r(p)===i.id?(o(),a("div",Ze)):b("",!0),e("span",null,k(E(i)),1)],8,Ge),e("button",{class:"btn btn-ghost btn-sm btn-square",onClick:w(y=>P(i),["stop"]),title:"Copier le contenu"},[...s[6]||(s[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1)])],8,Ke)],64)):b("",!0),n.id==="published"?(o(),a("button",{key:2,class:"btn btn-ghost btn-sm btn-full",onClick:w(y=>P(i),["stop"])},[...s[7]||(s[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"mr-2"},[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1),R(" Copier ",-1)])],8,Qe)):b("",!0)]),_:2},1032,["article","available-modules","onClick","onUpdateModules"]))),128)),n.articles.length===0?(o(),a("div",Xe,[s[8]||(s[8]=e("div",{class:"empty-icon"},"✨",-1)),e("p",null,k(n.emptyMessage),1)])):b("",!0)])],42,Ue))),128))]))]),I(me,{"is-open":r(d),title:r(V),description:r(S),"confirm-label":r(T),type:"danger",loading:r(c),"show-archive":"",onCancel:B,onConfirm:te,onConfirmArchive:ee},null,8,["is-open","title","description","confirm-label","loading"])]))}}),it=N(Ye,[["__scopeId","data-v-33890ef7"]]);export{it as default};
