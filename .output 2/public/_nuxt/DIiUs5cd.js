import{J as $,x as P,j as S,y as F,c,a as e,p as a,z as U,r as A,b as C,w as T,T as H,d as I,F as V,A as D,K as G,s as h,o as n,l as J,m as k,v as b,t as g,C as O,_ as R}from"./C_A17Xze.js";import{C as Z}from"./Ckzw1s2j.js";import{f as K}from"./pMK9VmZY.js";import{f as Q}from"./Cl4ISXQJ.js";const q=l=>l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),X=l=>l.replace(/^([A-Z])|[\s-_]+(\w)/g,(i,u,d)=>d?d.toUpperCase():u.toLowerCase()),Y=l=>{const i=X(l);return i.charAt(0).toUpperCase()+i.slice(1)},W=(...l)=>l.filter((i,u,d)=>!!i&&i.trim()!==""&&d.indexOf(i)===u).join(" ").trim(),z=l=>l==="";var w={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const ee=({name:l,iconNode:i,absoluteStrokeWidth:u,"absolute-stroke-width":d,strokeWidth:p,"stroke-width":f,size:m=w.width,color:v=w.stroke,...o},{slots:y})=>$("svg",{...w,...o,width:m,height:m,stroke:v,"stroke-width":z(u)||z(d)||u===!0||d===!0?Number(p||f||w["stroke-width"])*24/Number(m):p||f||w["stroke-width"],class:W("lucide",o.class,...l?[`lucide-${q(Y(l))}-icon`,`lucide-${q(l)}`]:["lucide-icon"])},[...i.map(_=>$(..._)),...y.default?[y.default()]:[]]);const x=(l,i)=>(u,{slots:d,attrs:p})=>$(ee,{...p,...u,iconNode:i,name:l},d);const se=x("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const te=x("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const ae=x("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const le=x("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),re={class:"admin-users-page"},oe={class:"page-header"},ne={key:1},ie={key:2},de={key:0,class:"form-container card"},ue={class:"form-grid"},ce={class:"form-group"},me={class:"form-group"},pe={class:"form-group"},ve={class:"form-group"},he={class:"form-group full-width"},fe={class:"form-actions"},ye=["disabled"],_e={key:0},ge={key:1},ke={class:"table-container card"},be={class:"users-table"},we={key:0},Ce={key:1},xe={class:"user-cell"},Me={class:"avatar-small"},Ue={class:"user-info"},Ae={class:"user-name"},$e={class:"user-email text-muted"},Ee={class:"role-badge"},Te={class:"text-secondary"},Ve={class:"actions-cell"},De=["onClick","disabled"],qe={class:"toasts"},ze={class:"toast-icon"},Be={class:"toast-message"},Ne=P({__name:"users",setup(l){const{user:i}=S(),u=h([]),d=h(!0),p=h(!1),f=h(!1),m=h(!1),v=h(null),o=h({email:"",password:"",first_name:"",last_name:"",role:""}),y=h([]),_=(r,s="success")=>{const t=Date.now();y.value.push({id:t,message:r,type:s}),setTimeout(()=>{y.value=y.value.filter(E=>E.id!==t)},4e3)},M=async()=>{d.value=!0;try{const r=await $fetch("/api/modules"),s=await $fetch("/api/admin/users");u.value=s||[]}catch(r){_("Erreur lors du chargement des profils","error"),console.error(r)}finally{d.value=!1}},B=async()=>{if(!p.value){p.value=!0;try{await $fetch("/api/admin/create-user",{method:"POST",body:o.value}),_("Utilisateur créé avec succès !"),m.value=!1,o.value={email:"",password:"",first_name:"",last_name:"",role:""},M()}catch(r){_(r.data?.statusMessage||r.message||"Erreur lors de la création","error")}finally{p.value=!1}}},N=r=>{v.value=r},j=async()=>{if(!(!v.value||f.value)){f.value=!0;try{await $fetch("/api/admin/delete-user",{method:"DELETE",query:{id:v.value.id}}),_("Utilisateur supprimé avec succès"),v.value=null,M()}catch(r){_(r.data?.statusMessage||r.message||"Erreur lors de la suppression","error")}finally{f.value=!1}}},L=r=>r?K(new Date(r),"d MMM yyyy, HH:mm",{locale:Q}):"n/a";return F(()=>{M()}),(r,s)=>(n(),c("div",re,[e("header",oe,[s[8]||(s[8]=e("div",{class:"header-content"},[e("h1",null,"Gestion des utilisateurs"),e("p",{class:"subtitle"},"Créez et gérez les comptes de votre plateforme")],-1)),e("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=t=>m.value=!a(m))},[a(m)?A("",!0):(n(),U(a(ae),{key:0,size:16})),a(m)?(n(),c("span",ie,"Masquer le formulaire")):(n(),c("span",ne,"Nouvel utilisateur"))])]),C(H,{name:"slide"},{default:T(()=>[a(m)?(n(),c("div",de,[s[14]||(s[14]=e("div",{class:"card-header"},[e("h3",null,"Nouvel utilisateur")],-1)),e("form",{onSubmit:J(B,["prevent"]),class:"user-form"},[e("div",ue,[e("div",ce,[s[9]||(s[9]=e("label",null,"Prénom",-1)),k(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>a(o).first_name=t),placeholder:"Ex: Jean",required:""},null,512),[[b,a(o).first_name]])]),e("div",me,[s[10]||(s[10]=e("label",null,"Nom",-1)),k(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>a(o).last_name=t),placeholder:"Ex: Dupont",required:""},null,512),[[b,a(o).last_name]])]),e("div",pe,[s[11]||(s[11]=e("label",null,"Email",-1)),k(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>a(o).email=t),type:"email",placeholder:"jean@example.com",required:""},null,512),[[b,a(o).email]])]),e("div",ve,[s[12]||(s[12]=e("label",null,"Mot de passe",-1)),k(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>a(o).password=t),type:"password",placeholder:"••••••••",required:""},null,512),[[b,a(o).password]])]),e("div",he,[s[13]||(s[13]=e("label",null,"Rôle (libre saisie)",-1)),k(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>a(o).role=t),placeholder:"Ex: admin, marketing, editor, designer...",required:""},null,512),[[b,a(o).role]])])]),e("div",fe,[e("button",{type:"button",class:"btn btn-outline",onClick:s[6]||(s[6]=t=>m.value=!1)},"Annuler"),e("button",{type:"submit",class:"btn btn-primary",disabled:a(p)},[a(p)?(n(),c("span",_e,"Création en cours...")):(n(),c("span",ge,"Créer l'utilisateur"))],8,ye)])],32)])):A("",!0)]),_:1}),e("div",ke,[e("table",be,[s[17]||(s[17]=e("thead",null,[e("tr",null,[e("th",null,"Utilisateur"),e("th",null,"Rôle"),e("th",null,"Créé le"),e("th",{class:"actions-header"},"Actions")])],-1)),e("tbody",null,[a(d)?(n(),c("tr",we,[...s[15]||(s[15]=[e("td",{colspan:"4",class:"status-cell"},[e("div",{class:"loading-spinner"}),I(" Chargement des profils... ")],-1)])])):a(u).length===0?(n(),c("tr",Ce,[...s[16]||(s[16]=[e("td",{colspan:"4",class:"status-cell"},"Aucun utilisateur trouvé",-1)])])):A("",!0),(n(!0),c(V,null,D(a(u),t=>(n(),c("tr",{key:t.id,class:"user-row"},[e("td",xe,[e("div",Me,g(t.first_name?.charAt(0).toUpperCase()||t.email?.charAt(0).toUpperCase()),1),e("div",Ue,[e("span",Ae,g(t.first_name)+" "+g(t.last_name),1),e("span",$e,g(t.email),1)])]),e("td",null,[e("span",Ee,g(t.role),1)]),e("td",Te,g(L(t.created_at)),1),e("td",Ve,[e("button",{class:"btn-icon btn-danger",onClick:E=>N(t),disabled:t.id===a(i)?.id,title:"Supprimer"},[C(a(le),{size:16})],8,De)])]))),128))])])]),C(Z,{"is-open":!!a(v),title:"Supprimer l'utilisateur",description:a(v)?`Êtes-vous sûr de vouloir supprimer ${a(v).email} ? Cette action est irréversible.`:"","confirm-label":"Supprimer définitivement",type:"danger",loading:a(f),onCancel:s[7]||(s[7]=t=>v.value=null),onConfirm:j},null,8,["is-open","description","loading"]),e("div",qe,[C(G,{name:"toast"},{default:T(()=>[(n(!0),c(V,null,D(a(y),t=>(n(),c("div",{key:t.id,class:O(["toast",t.type])},[e("div",ze,[t.type==="success"?(n(),U(a(te),{key:0,size:18})):(n(),U(a(se),{key:1,size:18}))]),e("span",Be,g(t.message),1)],2))),128))]),_:1})])]))}}),Fe=R(Ne,[["__scopeId","data-v-a7ae9a5e"]]);export{Fe as default};
